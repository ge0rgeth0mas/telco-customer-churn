<!-- index.html -->

<!DOCTYPE html>
<html>
<head>
    <title>Customer Churn Prediction</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <div class="container">
        <div class="title-background"></div>
        <h1>Customer Churn Prediction</h1>
        <form class="form" method="Predict">
            <div class="section">
                <h2>User Information</h2>

                <div class="row">
                    <div class="input-wrapper">
                        <!-- Gender -->
                        <label for="gender">Gender:</label><br>
                        <select id="gender" name="gender">
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                        </select><br>
                    </div>
                    <div class="input-wrapper">
                        <!-- Senior Citizen -->
                        <label for="seniorCitizen">Senior Citizen:</label><br>
                        <select id="seniorCitizen" name="SeniorCitizen">
                            <option value="Yes">Yes</option>
                            <option value="No">No</option>
                        </select><br>
                    </div>
                </div>

                <div class="row">
                    <div class="input-wrapper">
                        <!-- Partner -->
                        <label for="partner">Partner:</label><br>
                        <select id="partner" name="Partner">
                            <option value="Yes">Yes</option>
                            <option value="No">No</option>
                        </select><br>
                    </div>
                    <div class="input-wrapper">
                            <!-- Dependents -->
                            <label for="dependents">Dependents:</label><br>
                            <select id="dependents" name="Dependents">
                                <option value="Yes">Yes</option>
                                <option value="No">No</option>
                            </select><br>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>Services used</h2>

                <div class="row">
                    <div class="input-wrapper">
                        <!-- MultipleLines -->
                        <label for="multipleLines">Phone Service:</label><br>
                        <select id="multipleLines" name="MultipleLines">
                            <option value="No phone service">No Phone Service</option>
                            <option value="No">Single Line</option>
                            <option value="Yes">Multiple Lines</option>
                        </select><br>
                    </div>
                    <div class="input-wrapper">
                            <!-- InternetService -->
                            <label for="internetService">Internet Service:</label><br>
                            <select id="internetService" name="InternetService" onchange="updateOptions()">
                                <option value="No">No Internet Service</option>
                                <option value="DSL">DSL</option>
                                <option value="Fiber Optic">Fiber Optic</option>
                            </select><br>
                    </div>
                </div>

                <div class="row">
                    <div class="input-wrapper">
                        <!-- OnlineSecurity -->
                        <div id="onlineSecurityDiv" style="display: none;">
                            <label for="onlineSecurity">Online Security:</label><br>
                            <select id="onlineSecurity" name="OnlineSecurity">
                                <option value="No">No</option>
                                <option value="Yes">Yes</option>
                            </select><br>
                        </div>
                    </div>
                    <div class="input-wrapper">
                        <!-- OnlineBackup -->
                        <div id="onlineBackupDiv" style="display: none;">
                            <label for="onlineBackup">Online Backup:</label><br>
                            <select id="onlineBackup" name="OnlineBackup">
                                <option value="No">No</option>
                                <option value="Yes">Yes</option>
                            </select><br>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="input-wrapper">
                        <!-- DeviceProtection -->
                        <div id="deviceProtection" style="display: none;">
                            <label for="deviceProtection">Device Protection:</label><br>
                            <select id="deviceProtection" name="DeviceProtection">
                                <option value="No">No</option>
                                <option value="Yes">Yes</option>
                            </select><br>
                        </div>
                    </div>
                    <div class="input-wrapper">
                        <!-- TechSupport -->
                        <div id="techSupport" style="display: none;">
                            <label for="techSupport">Tech Support:</label><br>
                            <select id="techSupport" name="TechSupport">
                                <option value="No">No</option>
                                <option value="Yes">Yes</option>
                            </select><br>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="input-wrapper">
                        <!-- StreamingTV -->
                        <div id="streamingTV" style="display: none;">
                            <label for="streamingTV">Streaming TV:</label><br>
                            <select id="streamingTV" name="StreamingTV">
                                <option value="No">No</option>
                                <option value="Yes">Yes</option>
                            </select><br>
                        </div>
                    </div>
                    <div class="input-wrapper">
                        <!-- StreamingMovies -->
                        <div id="streamingMovies" style="display: none;">
                            <label for="streamingMovies">Streaming Movies:</label><br>
                            <select id="streamingMovies" name="StreamingMovies">
                                <option value="No">No</option>
                                <option value="Yes">Yes</option>
                            </select><br>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="input-wrapper">
                        <!-- PaperlessBilling -->
                        <label for="paperlessBilling">Paperless Billing:</label><br>
                        <select id="paperlessBilling" name="PaperlessBilling">
                            <option value="Yes">Yes</option>
                            <option value="No">No</option>
                        </select><br>
                    </div>
                    <div class="input-wrapper">
                        <!-- PaymentMethod -->
                        <label for="paymentMethod">Payment Method:</label><br>
                        <select id="paymentMethod" name="PaymentMethod">
                            <option value="Bank transfer (automatic)">Bank transfer (automatic)</option>
                            <option value="Credit card (automatic)">Credit card (automatic)</option>
                            <option value="Electronic check">Electronic check</option>
                            <option value="Mailed check">Mailed check</option>
                        </select><br>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>Payment Information</h2>

                <div class="row">
                    <div class="input-wrapper">
                        <!-- Contract -->
                        <label for="contract">Contract:</label><br>
                        <select id="contract" name="Contract">
                            <option value="Month-to-month">Month-to-month</option>
                            <option value="One year">One year</option>
                            <option value="Two year">Two year</option>
                        </select><br>
                    </div>
                    <div class="input-wrapper">
                        <!-- Tenure -->
                        <label for="tenure">Tenure:</label><br>
                        <input type="number" id="tenure" name="tenure" required><br>
                    </div>
                </div>

                <div class="row last-row">
                    <div class="input-wrapper">
                        <!-- MonthlyCharges -->
                        <label for="monthlyCharges">Monthly Charges:</label><br>
                        <input type="number" step="0.01" id="monthlyCharges" name="MonthlyCharges" required><br>
                    </div>
                    <div class="input-wrapper">
                        <!-- TotalCharges -->
                        <label for="totalCharges">Total Charges:</label><br>
                        <input type="number" step="0.01" id="totalCharges" name="TotalCharges" required><br>
                    </div>
                </div>

            </div>
            

            <!-- <input type="submit" value="Predict"> -->
            <button type="submit">Predict</button>
        </form>

        <div class="prediction-result">
            <p id="predictionResult"></p>
            <p id="probability"></p>
        </div>
    </div>

    <script>
        function updateOptions() {
            const internetService = document.getElementById("internetService");
            const onlineSecurityDiv = document.getElementById("onlineSecurityDiv");
            const onlineBackupDiv = document.getElementById("onlineBackupDiv");
            const deviceProtection = document.getElementById("deviceProtection");
            const techSupport = document.getElementById("techSupport");
            const streamingTV = document.getElementById("streamingTV");
            const streamingMovies = document.getElementById("streamingMovies");

            if (internetService.value === "No Internet Service") {
                onlineSecurityDiv.style.display = "none";
                onlineBackupDiv.style.display = "none";
                deviceProtection.style.display = "none";
                techSupport.style.display = "none";
                streamingTV.style.display = "none";
                streamingMovies.style.display = "none";
            } else {
                onlineSecurityDiv.style.display = "block";
                onlineBackupDiv.style.display = "block";
                deviceProtection.style.display = "block";
                techSupport.style.display = "block";
                streamingTV.style.display = "block";
                streamingMovies.style.display = "block";
            }
        }

        const formEl = document.querySelector('.form');

        formEl.addEventListener('submit', event=> {
            event.preventDefault();

            const formData = new FormData(formEl);

            const data = Object.fromEntries(formData);
            // console.log(formData);
            console.log(data);
            console.log(JSON.stringify(data));

            fetch('/predict', {
                method : 'POST',
                headers : {
                    'Content-Type' : 'application/json'
                },
                body: JSON.stringify(data),
            }).then(response => response.json())
                // .then(data => console.log(data))
                .then(result => {
                    if (result.churn_prediction === true) {
                    predictionResult.innerHTML = `Customer will churn`;
                    probability.innerHTML = `Chances of churn = ${result.churn}%`;
                    } else {
                    predictionResult.innerHTML = `Customer will not churn`;
                    probability.innerHTML = `Chances of retention = ${result.retention}%`;

                    }
                })
                .catch(error => console.log(error));
        })

        
    </script>
</body>
</html>
